# version: "3.8"

services:
  # docker:
  #   image: docker:dind
  #   container_name: docker
  #   privileged: true # Necesario para que Docker funcione
  #   environment:
  #     DOCKER_TLS_CERTDIR: "" # Desactiva TLS (conexiÃ³n simple)
  #   volumes:
  #     - docker_data:/var/lib/docker

  jenkins:
    container_name: jenkins
    build: . # ðŸ‘ˆ USA EL DOCKERFILE
    ports:
      - "8080:8080" # UI Jenkins
      - "5000:5000"
    environment:
      - JENKINS_OPTS=--prefix=/jenkins # RaÃ­z ya no es /, ahora es /jenkins
      # DOCKER_HOST: tcp://docker:2375 # Jenkins se conecta al Docker engine

    restart: always
    volumes:
      - jenkins_data:/var/jenkins_home
      - /var/run/docker.sock:/var/run/docker.sock  # ðŸ‘ˆ CLAVE

    # depends_on:
      # - docker # Espera a que Docker estÃ© listo

volumes:
  jenkins_data:
    external: true
    name: jenkins_data
    
  # docker_data:
  #   external: true
  #   name: docker_data

# name: ${JENKINS_VOLUME_NAME}